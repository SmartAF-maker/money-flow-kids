<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Money Flow Kids</title>

    <link rel="stylesheet" href="1.css" />

    <!-- WOW Jars ‚Äì styl tylko dla s≈Çoik√≥w (zawsze widoczne) -->
    <style>
      /* ============= WOW JARS (always visible) ============= */
      .jars {
        display: grid !important;
        grid-template-columns: repeat(4, minmax(220px, 1fr));
        gap: 12px;
        align-items: start;
      }
      @media (max-width: 1200px) { .jars { grid-template-columns: repeat(2, minmax(220px, 1fr)); } }
      @media (max-width: 560px)  { .jars { grid-template-columns: 1fr; } }

      .wow-jars .jar-card {
        display: flex; flex-direction: column; align-items: center; gap: 8px;
        text-align: center; min-height: 260px;
      }
      .jar-svg { width: 140px; height: auto; display: block; }

      /* Poziom cieczy: sterowany przez --fill */
      .jar-svg .liquid { transform: translateY(calc(-1 * var(--fill, 0%))); transition: transform .6s cubic-bezier(.22,1,.36,1); }

      /* Falowanie tafli */
      .jar-svg .wave { transform-origin: 50% 0%; animation: waveMove 3.5s ease-in-out infinite alternate; }
      @keyframes waveMove { from { transform: translateY(-2px) scaleX(1.02); } to { transform: translateY(2px) scaleX(0.98); } }

      /* BƒÖbelki */
      .jar-svg .bubbles circle { animation: bubbleUp 4s linear infinite; }
      .jar-svg .bubbles circle:nth-child(2){ animation-delay: .8s; }
      .jar-svg .bubbles circle:nth-child(3){ animation-delay: 1.6s; }
      @keyframes bubbleUp { 0%{transform:translateY(0);opacity:.7;}80%{transform:translateY(-26px);opacity:.3;}100%{transform:translateY(-32px);opacity:0;} }

      /* Hover */
      .wow-jars .jar-card:hover .jar-svg { filter: drop-shadow(0 6px 12px rgba(31,61,98,.22)); transform: translateY(-1px); transition: filter .25s, transform .25s; }

      /* Glow */
      .jar-svg .liquid, .jar-svg .wave {
        filter: saturate(1.15) contrast(1.08)
                drop-shadow(0 0 8px var(--glow, rgba(255,255,255,.14)))
                drop-shadow(0 0 16px var(--glow, rgba(255,255,255,.10)));
        pointer-events: none;
      }

      /* Kolory s≈Çoik√≥w */
      .wow-jars .jar-card:nth-child(1) .jar-svg { --liq-top:#1ff35b; --liq-bottom:#1e9e1e; --glow:#18ff64; } /* Savings */
      .wow-jars .jar-card:nth-child(2) .jar-svg { --liq-top:#f38a03; --liq-bottom:#915201; --glow:#ffb341; } /* Earnings */
      .wow-jars .jar-card:nth-child(3) .jar-svg { --liq-top:#df48b9; --liq-bottom:#660a29; --glow:#ff0ac2; } /* Gifts */
      .wow-jars .jar-card:nth-child(4) .jar-svg { --liq-top:#134dc7; --liq-bottom:#0b2e77; --glow:#4e7cff; } /* Invest */

      /* RWD ‚Äì sama grafika s≈Çoika */
      @media (max-width: 520px) { .jar-svg { width: 110px; } }
    </style>

    <!-- RWD GRID PATCH (zak≈Çadki; NIE dotyka s≈Çoik√≥w) -->
    <style>
      #tab-invest, #tab-fx, #tab-parent, #tab-profits {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(560px, 1fr));
        gap: 12px;
        align-items: start;
      }
      @media (max-width: 1400px) { #tab-invest, #tab-fx, #tab-profits { grid-template-columns: 1fr; } }

      #tab-parent { grid-template-columns: repeat(2, minmax(420px, 1fr)); gap: 12px; }
      @media (max-width: 900px) { #tab-parent { grid-template-columns: 1fr; } }

      #tab-invest > .card, #tab-fx > .card, #tab-parent > .card, #tab-profits > .card { min-width: 0; }
      #tab-invest .tableWrap, #tab-fx .tableWrap, #tab-profits .tableWrap { overflow-x: auto; }

      /* KPI ‚Äì kontenerki */
      .grid.g-3 { display: grid; grid-template-columns: repeat(3, minmax(220px,1fr)); gap: 12px; }
      @media (max-width: 1200px) { .grid.g-3 { grid-template-columns: 1fr; } }
      .kpi{ background: var(--card-bg, rgba(255,255,255,0.03)); border: 1px solid rgba(255,255,255,.06); border-radius: 10px; padding: 12px; }
      .kpi > .muted { font-size: .9rem; }
      .kpi > div:last-child { font-weight: 700; font-size: 1.1rem; }

      /* Profits ‚Äì jedna kolumna: KPI -> Stocks -> FX */
      #tab-profits { grid-template-columns: 1fr !important; }

      /* Tutorial modal */
      #tutorialModal .modal-content { width: min(720px, 92vw); }
      #tutorialModal img { max-width: 100%; height: auto; display: block; }

      /* Global Trends ‚Äì widoczne; ukrywamy/wy≈õwietlamy klasƒÖ .hidden z JS */
      #globalTrendsCard { display: block; }
      .hidden { display: none !important; }
    </style>

    <!-- CSP: allow live data endpoints for fetch() (Tylko w <head>) -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src  'self' 'unsafe-inline';
      style-src   'self' 'unsafe-inline';
      img-src     'self' data: blob:;
      font-src    'self' data:;
      connect-src 'self'
                   https://api.exchangerate.host
                   https://query1.finance.yahoo.com
                   https://query2.finance.yahoo.com
                   https://r.jina.ai;
      frame-src   'none';
      base-uri    'self';
      form-action 'self'">
  </head>

  <body>
    <header class="topbar">
      <h1 id="t-appTitle">Money Flow Kids</h1>

      <div class="role-switch">
        <select id="langSelect" title="Language">
          <option value="pl">PL</option>
          <option value="en" selected>EN</option>
          <option value="es">ES</option>
        </select>

        <div class="role-parent-only" style="display:inline-flex;align-items:center;gap:6px">
          <label class="muted" for="childSelector"></label>
          <select id="childSelector" class="input" style="min-width:160px"></select>
        </div>

        <button id="addChildBtn" class="tab role-parent-only" data-i18n="addChild">+ Add child</button>
        <button class="tab active" data-tab="invest" data-i18n="tabStocks">Stocks</button>
        <button class="tab" data-tab="fx" data-i18n="tabFx">Currencies (FX)</button>
        <button class="tab" data-tab="profits" data-i18n="tabPnL">Profits</button>
        <button class="tab role-parent-only" data-tab="parent" data-i18n="tabParent">Parent</button>
        <button id="tutorialBtn" class="tab">üìò <span data-i18n="tutorial">Tutorial</span></button>
      </div>

      <div class="authwrap">
        <span id="authBadge" class="muted" aria-live="polite">Guest</span>
        <button id="loginBtn" class="tab"><span id="t-btnLoginTop">Login</span></button>
        <button id="logoutBtn" class="tab hidden"><span id="t-btnLogout">Logout</span></button>
      </div>
    </header>

    <!-- Sticky mini jars (below top buttons) -->
    <section id="stickyMiniJars" class="mini-jars sticky" aria-label="Quick jars totals">
      <div class="mini-jar">
        <div class="mini-jar-label">Available cash</div>
        <div id="miniCash" class="mini-jar-value">0.00 USD</div>
      </div>
      <div class="mini-jar">
        <div class="mini-jar-label" data-i18n="jarSavings">Savings</div>
        <div id="miniSave" class="mini-jar-value">0.00 USD</div>
      </div>
      <div class="mini-jar">
        <div class="mini-jar-label" data-i18n="jarSpending">Earnings</div>
        <div id="miniSpend" class="mini-jar-value">0.00 USD</div>
      </div>
      <div class="mini-jar">
        <div class="mini-jar-label" data-i18n="jarGiving">Gifts</div>
        <div id="miniGive" class="mini-jar-value">0.00 USD</div>
      </div>
      <div class="mini-jar">
        <div class="mini-jar-label" data-i18n="jarInvest">Investments</div>
        <div id="miniInvest" class="mini-jar-value">0.00 USD</div>
      </div>
    </section>

    <main class="container">
      <!-- Live mode switch -->
      <section class="card">
        <div class="row">
          <div class="title" data-i18n="dataMode">Data Mode</div>
          <label class="switch"><input type="checkbox" id="liveModeToggle" /><span class="slider"></span></label>
          <div id="liveModeLabel" class="muted">Simulation (offline)</div>
          <div id="liveStatus" class="muted" style="margin-top:6px"></div>
        </div>
        <div class="sub" data-i18n="dataModeHint">In Live mode, prices/rates come from the backend (requires active subscription or trial).</div>
      </section>

      <!-- S≈Çoiki ‚Äì ZAWSZE -->
      <section class="jars wow-jars">
        <!-- Savings -->
        <div class="card jar-card" style="--fill:0%">
          <!-- SVG jar -->
          <!-- (Savings SVG left unchanged for brevity; identical to your version) -->
          <!-- === BEGIN Savings SVG === -->
          <svg class="jar-svg" viewBox="0 0 200 240" aria-hidden="true">
            <defs>
              <linearGradient id="lidGrad_s" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#c9d2df"/>
                <stop offset="40%" stop-color="#f5f7fa"/>
                <stop offset="60%" stop-color="#aeb9c8"/>
                <stop offset="100%" stop-color="#e6ecf3"/>
              </linearGradient>
              <linearGradient id="glassGrad_s" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"   stop-color="#ffffff" stop-opacity="0.20"/>
                <stop offset="70%"  stop-color="#f8fbff" stop-opacity="0.12"/>
                <stop offset="100%" stop-color="#eef5ff" stop-opacity="0.05"/>
              </linearGradient>
              <linearGradient id="shineGrad_s" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
              </linearGradient>
              <linearGradient id="liqGrad_s" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="var(--liq-top,#41d98a)"/>
                <stop offset="100%" stop-color="var(--liq-bottom,#00c853)"/>
              </linearGradient>
              <filter id="shadowBlur_s" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                <feOffset dx="0" dy="2" result="off"/>
                <feMerge><feMergeNode in="off"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <path id="jarPath_s" d="M45,40 h110 a16,16 0 0 1 16,16 v110 a24,24 0 0 1 -24,24 h-94 a24,24 0 0 1 -24,-24 v-110 a16,16 0 0 1 16,-16 z"/>
              <clipPath id="clip_s"><use href="#jarPath_s"/></clipPath>
            </defs>
            <ellipse cx="100" cy="224" rx="60" ry="10" fill="#000" opacity="0.12"></ellipse>
            <rect x="40" y="16" width="120" height="22" rx="6" fill="url(#lidGrad_s)" stroke="#6f7f93" stroke-width="2" filter="url(#shadowBlur_s)"/>
            <rect x="48" y="14" width="104" height="6" rx="3" fill="#aab6c5" opacity=".55"/>
            <use href="#jarPath_s" fill="url(#glassGrad_s)" stroke="#b7c7db" stroke-width="2.5"/>
            <g clip-path="url(#clip_s)">
              <rect class="liquid" x="32" y="240" width="136" height="160" fill="url(#liqGrad_s)"/>
              <path class="wave" d="M20,0 C40,8 60,-8 80,0 S120,8 140,0 S180,-8 200,0 v40 h-180 z" fill="rgba(255,255,255,.25)"/>
              <g class="bubbles" fill="#ffffff" opacity=".65">
                <circle cx="70" cy="200" r="3"/><circle cx="120" cy="190" r="2.5"/><circle cx="95" cy="180" r="2"/>
              </g>
            </g>
            <path d="M62,48 c0,0 28,-10 76,0 v120 c-34,16 -64,16 -76,0 z" fill="url(#shineGrad_s)" opacity=".35"/>
            <rect x="38" y="38" width="124" height="4" rx="2" fill="#fff" opacity=".6"/>
          </svg>
          <!-- === END Savings SVG === -->

          <div class="muted" data-i18n="jarSavings">Savings</div>
          <div id="saveAmt" class="title">0.00 USD</div>
          <div class="jar-actions">
            <input type="number" min="0.01" step="0.01" class="jar-input">
            <button class="btn" data-add="save" data-i18n="add">+ Add</button>
          </div>
        </div>

        <!-- Earnings -->
        <div class="card jar-card" style="--fill:0%">
          <!-- (Earnings SVG ‚Äì bez zmian) -->
          <svg class="jar-svg" viewBox="0 0 200 240" aria-hidden="true">
            <defs>
              <linearGradient id="lidGrad_e" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#c9d2df"/>
                <stop offset="40%" stop-color="#f5f7fa"/>
                <stop offset="60%" stop-color="#aeb9c8"/>
                <stop offset="100%" stop-color="#e6ecf3"/>
              </linearGradient>
              <linearGradient id="glassGrad_e" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"   stop-color="#ffffff" stop-opacity="0.20"/>
                <stop offset="70%"  stop-color="#f8fbff" stop-opacity="0.12"/>
                <stop offset="100%" stop-color="#eef5ff" stop-opacity="0.05"/>
              </linearGradient>
              <linearGradient id="shineGrad_e" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
              </linearGradient>
              <linearGradient id="liqGrad_e" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="var(--liq-top,#ffb74d)"/>
                <stop offset="100%" stop-color="var(--liq-bottom,#ff9800)"/>
              </linearGradient>
              <filter id="shadowBlur_e" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                <feOffset dx="0" dy="2" result="off"/>
                <feMerge><feMergeNode in="off"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <path id="jarPath_e" d="M45,40 h110 a16,16 0 0 1 16,16 v110 a24,24 0 0 1 -24,24 h-94 a24,24 0 0 1 -24,-24 v-110 a16,16 0 0 1 16,-16 z"/>
              <clipPath id="clip_e"><use href="#jarPath_e"/></clipPath>
            </defs>
            <ellipse cx="100" cy="224" rx="60" ry="10" fill="#000" opacity="0.12"></ellipse>
            <rect x="40" y="16" width="120" height="22" rx="6" fill="url(#lidGrad_e)" stroke="#6f7f93" stroke-width="2" filter="url(#shadowBlur_e)"/>
            <rect x="48" y="14" width="104" height="6" rx="3" fill="#aab6c5" opacity=".55"/>
            <use href="#jarPath_e" fill="url(#glassGrad_e)" stroke="#b7c7db" stroke-width="2.5"/>
            <g clip-path="url(#clip_e)">
              <rect class="liquid" x="32" y="240" width="136" height="160" fill="url(#liqGrad_e)"/>
              <path class="wave" d="M20,0 C40,8 60,-8 80,0 S120,8 140,0 S180,-8 200,0 v40 h-180 z" fill="rgba(255,255,255,.25)"/>
              <g class="bubbles" fill="#ffffff" opacity=".7">
                <circle cx="80" cy="200" r="3"/><circle cx="130" cy="190" r="2.5"/><circle cx="105" cy="175" r="2"/>
              </g>
            </g>
            <path d="M62,48 c0,0 28,-10 76,0 v120 c-34,16 -64,16 -76,0 z" fill="url(#shineGrad_e)" opacity=".35"/>
            <rect x="38" y="38" width="124" height="4" rx="2" fill="#fff" opacity=".6"/>
          </svg>

          <div class="muted" data-i18n="jarSpending">Earnings</div>
          <div id="spendAmt" class="title">0.00 USD</div>
          <div class="jar-actions">
            <input type="number" min="0.01" step="0.01" class="jar-input">
            <button class="btn" data-add="spend" data-i18n="add">+ Add</button>
          </div>
        </div>

        <!-- Gifts -->
        <div class="card jar-card" style="--fill:0%">
          <!-- (Gifts SVG ‚Äì bez zmian) -->
          <svg class="jar-svg" viewBox="0 0 200 240" aria-hidden="true">
            <defs>
              <linearGradient id="lidGrad_d" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#c9d2df"/>
                <stop offset="40%" stop-color="#f5f7fa"/>
                <stop offset="60%" stop-color="#aeb9c8"/>
                <stop offset="100%" stop-color="#e6ecf3"/>
              </linearGradient>
              <linearGradient id="glassGrad_d" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"   stop-color="#ffffff" stop-opacity="0.20"/>
                <stop offset="70%"  stop-color="#f8fbff" stop-opacity="0.12"/>
                <stop offset="100%" stop-color="#eef5ff" stop-opacity="0.05"/>
              </linearGradient>
              <linearGradient id="shineGrad_d" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
              </linearGradient>
              <linearGradient id="liqGrad_d" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="var(--liq-top,#ff6fa3)"/>
                <stop offset="100%" stop-color="var(--liq-bottom,#e91e63)"/>
              </linearGradient>
              <filter id="shadowBlur_d" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                <feOffset dx="0" dy="2" result="off"/>
                <feMerge><feMergeNode in="off"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <path id="jarPath_d" d="M45,40 h110 a16,16 0 0 1 16,16 v110 a24,24 0 0 1 -24,24 h-94 a24,24 0 0 1 -24,-24 v-110 a16,16 0 0 1 16,-16 z"/>
              <clipPath id="clip_d"><use href="#jarPath_d"/></clipPath>
            </defs>
            <ellipse cx="100" cy="224" rx="60" ry="10" fill="#000" opacity="0.12"></ellipse>
            <rect x="40" y="16" width="120" height="22" rx="6" fill="url(#lidGrad_d)" stroke="#6f7f93" stroke-width="2" filter="url(#shadowBlur_d)"/>
            <rect x="48" y="14" width="104" height="6" rx="3" fill="#aab6c5" opacity=".55"/>
            <use href="#jarPath_d" fill="url(#glassGrad_d)" stroke="#b7c7db" stroke-width="2.5"/>
            <g clip-path="url(#clip_d)">
              <rect class="liquid" x="32" y="240" width="136" height="160" fill="url(#liqGrad_d)"/>
              <path class="wave" d="M20,0 C40,8 60,-8 80,0 S120,8 140,0 S180,-8 200,0 v40 h-180 z" fill="rgba(255,255,255,.25)"/>
              <g class="bubbles" fill="#ffffff" opacity=".7">
                <circle cx="88" cy="198" r="3"/><circle cx="124" cy="186" r="2.5"/><circle cx="108" cy="172" r="2"/>
              </g>
            </g>
            <path d="M62,48 c0,0 28,-10 76,0 v120 c-34,16 -64,16 -76,0 z" fill="url(#shineGrad_d)" opacity=".35"/>
            <rect x="38" y="38" width="124" height="4" rx="2" fill="#fff" opacity=".6"/>
          </svg>

          <div class="muted" data-i18n="jarGiving">Gifts</div>
          <div id="giveAmt" class="title">0.00 USD</div>
          <div class="jar-actions">
            <input type="number" min="0.01" step="0.01" class="jar-input">
            <button class="btn" data-add="give" data-i18n="add">+ Add</button>
          </div>
        </div>

        <!-- Invest (cash) -->
        <div class="card jar-card" style="--fill:0%">
          <!-- (Invest SVG ‚Äì bez zmian) -->
          <svg class="jar-svg" viewBox="0 0 200 240" aria-hidden="true">
            <defs>
              <linearGradient id="lidGrad_i" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#c9d2df"/>
                <stop offset="40%" stop-color="#f5f7fa"/>
                <stop offset="60%" stop-color="#aeb9c8"/>
                <stop offset="100%" stop-color="#e6ecf3"/>
              </linearGradient>
              <linearGradient id="glassGrad_i" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%"   stop-color="#ffffff" stop-opacity="0.20"/>
                <stop offset="70%"  stop-color="#f8fbff" stop-opacity="0.12"/>
                <stop offset="100%" stop-color="#eef5ff" stop-opacity="0.05"/>
              </linearGradient>
              <linearGradient id="shineGrad_i" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
              </linearGradient>
              <linearGradient id="liqGrad_i" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="var(--liq-top,#6a8cff)"/>
                <stop offset="100%" stop-color="var(--liq-bottom,#3f51b5)"/>
              </linearGradient>
              <filter id="shadowBlur_i" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                <feOffset dx="0" dy="2" result="off"/>
                <feMerge><feMergeNode in="off"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <path id="jarPath_i" d="M45,40 h110 a16,16 0 0 1 16,16 v110 a24,24 0 0 1 -24,24 h-94 a24,24 0 0 1 -24,-24 v-110 a16,16 0 0 1 16,-16 z"/>
              <clipPath id="clip_i"><use href="#jarPath_i"/></clipPath>
            </defs>
            <ellipse cx="100" cy="224" rx="60" ry="10" fill="#000" opacity="0.12"></ellipse>
            <rect x="40" y="16" width="120" height="22" rx="6" fill="url(#lidGrad_i)" stroke="#6f7f93" stroke-width="2" filter="url(#shadowBlur_i)"/>
            <rect x="48" y="14" width="104" height="6" rx="3" fill="#aab6c5" opacity=".55"/>
            <use href="#jarPath_i" fill="url(#glassGrad_i)" stroke="#b7c7db" stroke-width="2.5"/>
            <g clip-path="url(#clip_i)">
              <rect class="liquid" x="32" y="240" width="136" height="160" fill="url(#liqGrad_i)"/>
              <path class="wave" d="M20,0 C40,8 60,-8 80,0 S120,8 140,0 S180,-8 200,0 v40 h-180 z" fill="rgba(255,255,255,.25)"/>
              <g class="bubbles" fill="#ffffff" opacity=".7">
                <circle cx="78" cy="198" r="3"/><circle cx="126" cy="188" r="2.5"/><circle cx="102" cy="176" r="2"/>
              </g>
            </g>
            <path d="M62,48 c0,0 28,-10 76,0 v120 c-34,16 -64,16 -76,0 z" fill="url(#shineGrad_i)" opacity=".35"/>
            <rect x="38" y="38" width="124" height="4" rx="2" fill="#fff" opacity=".6"/>
          </svg>

          <div class="muted" data-i18n="jarInvest">Investments</div>
          <div id="investAmt" class="title">0.00 USD</div>
          <div class="jar-actions">
            <input type="number" min="0.01" step="0.01" class="jar-input">
            <button class="btn" data-add="invest" data-i18n="add">+ Add</button>
          </div>
        </div>
      </section>

      <!-- Net Worth + Available Cash + Quick Actions -->
      <section class="grid g-3" style="grid-template-columns: repeat(3, 1fr); gap: 12px;">
        <div class="card">
          <div class="title" data-i18n="netWorth">Net Worth</div>
          <div id="netWorth" class="big">0.00 USD</div>
          <div class="sub" data-i18n="netWorthHint">
            Total jars + stock portfolio + FX portfolio (in USD).
          </div>
        </div>

        <div class="card available-cash">
          <div class="title">Available Cash</div>
          <div id="availableCash" class="big">0.00 USD</div>
          <div class="sub">Savings + Earnings + Gifts (in USD)</div>
        </div>

        <div class="card">
          <div class="title" data-i18n="quickActions">Quick Actions</div>
          <div class="space">
            <button class="btn" id="addAllowance" data-i18n="allowance10">Allowance 10 USD</button>
            <button class="btn" id="moveSpendSave" data-i18n="move5">Move Earnings ‚Üí Savings</button>
            <button id="moveDonToSave" class="btn" data-i18n="moveDonToSave">Move Gifts ‚Üí Savings</button>
          </div>
        </div>
      </section>

      <!-- Global Trends -->
      <section class="card" id="globalTrendsCard">
        <div class="title" id="t-globalTrends">Global Trends</div>
        <div id="globalTrendsSub" class="muted">World stock indices</div>
        <div id="globalTrendsList" class="trend-list"></div>
      </section>

      <!-- Stocks -->
      <section id="tab-invest" class="grid">
        <div class="card">
          <div class="row"><div class="title" data-i18n="stocksMarket">Stock Market</div></div>

          <div class="row" style="margin: 6px 0" id="stockControls">
            <select id="stockRegion" class="input" title="Region" style="max-width: 170px">
              <option value="all">All regions</option>
              <option value="usa">USA</option>
              <option value="eu">Europe</option>
              <option value="cn">China</option>
            </select>

            <input id="stockSearch" class="input" placeholder="AAPL, Microsoft‚Ä¶" />
            <button id="stockAddPopular" class="btn">Add more</button>
          </div>

          <div id="stockList" class="grid" style="grid-template-columns: 1fr; gap: 8px"></div>

          <div id="tradeBox" class="card" style="margin-top: 12px; display: none">
            <div class="title" id="tradeTitle">Transaction</div>

            <div class="row" style="margin-bottom: 8px">
              <label class="muted" data-i18n="qty">Quantity</label>
              <input id="qty" type="number" min="1" step="1" value="1" class="input" />
              <div class="right muted"><span data-i18n="cost">Cost:</span> <span id="cost">0.00 USD</span></div>
            </div>

            <div class="space">
              <button id="buyBtn" class="btn primary" data-i18n="buy">Buy (investment cash)</button>
              <button id="cancelTrade" class="btn" data-i18n="cancel">Cancel</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="title" data-i18n="stocksPortfolio">Stock Portfolio</div>
          <div id="portfolioEmpty" class="muted" data-i18n="empty">No positions.</div>
          <div class="tableWrap" style="overflow: auto; display: none">
            <table>
              <thead>
                <tr class="muted">
                  <th data-i18n="ticker">Ticker</th>
                  <th data-i18n="shares">Shares</th>
                  <th data-i18n="avgCost">Avg. cost</th>
                  <th data-i18n="price">Price</th>
                  <th data-i18n="value">Value</th>
                  <th>P/L</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="portfolioBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- FX -->
      <section id="tab-fx" class="grid hidden">
        <div class="card">
          <div class="row"><div class="title" data-i18n="fxMarket">Currency Market (FX)</div></div>

          <div class="row" style="margin: 6px 0">
            <input id="fxSearch" class="input" placeholder="EUR/PLN, USD" />
            <button id="fxMoreBtn" class="btn" data-i18n="addMajors">Add more currencies</button>
          </div>

          <div id="fxList" class="grid" style="grid-template-columns: 1fr; gap: 8px"></div>

          <div id="fxTradeBox" class="card" style="margin-top: 12px; display: none">
            <div class="title" id="fxTradeTitle" data-i18n="fxTrade">FX Transaction</div>

            <div class="row" style="margin-bottom: 8px">
              <label class="muted" data-i18n="qtyBase">Quantity (base currency)</label>
              <input id="fxQty" type="number" min="1" step="1" value="100" class="input" />
              <div class="right muted"><span data-i18n="cost">Cost:</span> <span id="fxCost">0.00 USD</span></div>
            </div>

            <div class="space">
              <button id="fxBuyBtn" class="btn primary" data-i18n="buy">Buy (investment cash)</button>
              <button id="fxCancelTrade" class="btn" data-i18n="cancel">Cancel</button>
            </div>

            <div class="sub" data-i18n="fxHint"></div>
          </div>
        </div>

        <div class="card">
          <div class="title" data-i18n="fxPortfolio">FX Portfolio</div>
          <div id="fxEmpty" class="muted" data-i18n="empty">No positions.</div>
          <div class="tableWrap" style="overflow: auto; display: none">
            <table>
              <thead>
                <tr class="muted">
                  <th data-i18n="pair">Pair</th>
                  <th data-i18n="amount">Amount</th>
                  <th data-i18n="avgRate">Avg. rate</th>
                  <th data-i18n="rate">Rate</th>
                  <th>Value (USD)</th>
                  <th>P/L</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="fxBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Profits -->
      <section id="tab-profits" class="grid hidden">
        <div class="card">
          <div class="title">Total Profit and Loss</div>
          <div class="grid g-3">
            <div class="kpi"><div class="muted">Realized (Stocks)</div><div id="kpiRealizedStocks">0.00 USD</div></div>
            <div class="kpi"><div class="muted">Unrealized (Stocks)</div><div id="kpiUnrealizedStocks">0.00 USD</div></div>
            <div class="kpi"><div class="muted">Realized (FX)</div><div id="kpiRealizedFx">0.00 USD</div></div>
            <div class="kpi"><div class="muted">Unrealized (FX)</div><div id="kpiUnrealizedFx">0.00 USD</div></div>
            <div class="kpi"><div class="muted">Total earned</div><div id="kpiTotal">0.00 USD</div></div>
            <div class="kpi"><div class="muted">Total loss</div><div id="kpiTotalLoss">0.00 USD</div></div>
          </div>
        </div>

        <div class="card">
          <div class="title">Sales History (Stocks)</div>
          <div class="tableWrap" style="overflow:auto; max-height: 260px;">
            <table>
              <thead>
                <tr class="muted">
                  <th>Date</th><th>Ticker</th><th>Qty</th><th>Price</th><th>Avg. cost</th><th>P/L</th>
                </tr>
              </thead>
              <tbody id="tradeHistoryBody"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="title">Sales History (FX)</div>
          <div class="tableWrap" style="overflow:auto; max-height: 260px;">
            <table>
              <thead>
                <tr class="muted">
                  <th>Date</th><th>Pair</th><th>Qty</th><th>Rate</th><th>Avg. rate</th><th>P/L</th>
                </tr>
              </thead>
              <tbody id="fxHistoryBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Parent -->
      <section id="tab-parent" class="grid hidden" data-parent-only="1" style="grid-template-columns: repeat(2, minmax(420px, 1fr)); gap: 12px;">
        <div class="card">
          <div class="title" data-i18n="parentPanel">Parent Panel</div>
          <div class="sub">Set up a recurring monthly allowance (virtual, in-app only).</div>

          <form id="allowanceForm" class="row" autocomplete="off">
            <input id="allowanceAmount" type="number" step="0.01" min="0.50" placeholder="Monthly amount (USD)" required />
            <input id="allowanceDay" type="number" min="1" max="28" placeholder="Day of month (1‚Äì28)" required />
            <input id="allowanceStart" type="date" placeholder="Start date" />
            <input id="allowancePin" type="password" maxlength="6" placeholder="Parent PIN (4‚Äì6 digits)" required />
            <button type="submit" class="btn">Save allowance</button>
          </form>

          <p class="sub" style="margin-top:8px">
            The app will auto-top-up the <strong>Savings</strong> jar each month on the selected day.
            The start date is optional (defaults to today). Max day is 28 to avoid month-length issues.
          </p>

          <div class="config" style="margin-top:14px">
            <h4 data-i18n="Settings">Settings</h4>

            <form id="settingsForm" class="row" autocomplete="off" style="margin-bottom:10px">
              <input id="setDailyLimit" type="number" step="0.01" min="1" placeholder="Daily limit (jar capacity scale)" />
              <button type="submit" class="btn" data-i18n="save">Save</button>
            </form>

            <div class="pin-setup">
              <label class="label">Set/change PIN (4‚Äì6 digits)</label>

              <div class="pin-field">
                <input type="password" id="pin1" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="Enter new PIN">
                <button type="button" class="icon-btn" id="pin1Eye" aria-label="Show/Hide PIN">üëÅÔ∏è</button>
              </div>

              <div class="pin-field" style="margin-top:6px">
                <input type="password" id="pin2" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="Confirm new PIN">
                <button type="button" class="icon-btn" id="pin2Eye" aria-label="Show/Hide PIN">üëÅÔ∏è</button>
              </div>

              <div class="form-row end" style="margin-top:8px">
                <button id="savePinBtn" class="btn primary" type="button">Save PIN</button>
              </div>

              <p id="pinMsg" class="form-msg" aria-live="polite"></p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="title" data-i18n="ledgerTitle">History (allowance / expenses)</div>
          <div class="row" style="margin-bottom: 8px">
            <select id="filterType">
              <option value="all" data-i18n="all">All</option>
              <option value="in" data-i18n="topups">Top-ups</option>
              <option value="out" data-i18n="expenses">Expenses</option>
            </select>
            <button id="clearDataBtn" class="btn danger" data-i18n="clearDemo">Clear (demo)</button>
          </div>
          <ul id="ledger"></ul>
        </div>
      </section>
    </main>

    <footer class="footer"><small id="t-footerNote"> </small></footer>

    <!-- Tutorial modal -->
    <div id="tutorialModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="tutorialTitle" aria-describedby="tutorialText">
      <div class="modal-content">
        <div class="tutorial-controls" aria-label="Tutorial controls">
          <button id="prevStep" type="button" title="Previous step">‚Üê</button>
          <button id="nextStep" type="button" title="Next step">‚Üí</button>
          <button id="closeTutorial" type="button" class="danger" title="Close">√ó</button>
        </div>
        <div class="tut-head">
          <div id="tutorialIcon" class="tut-icon" aria-hidden="true">üìò</div>
          <div><h2 id="tutorialTitle">Tutorial</h2><p id="tutorialText" class="muted"></p></div>
        </div>
        <div class="tut-image-wrap">
          <img id="tutorialImage" src="piggy.png" alt="Tutorial image" />
          <div id="tutCaption" class="muted" role="note"></div>
        </div>
      </div>
    </div>

    <!-- Login modal -->
    <div id="loginModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="modal-content">
        <h2 id="loginTitle" class="title" style="margin-bottom:12px">Login</h2>

        <div class="row" style="margin-bottom:8px">
          <label><input type="radio" name="role" value="child" checked /> <span id="t-roleChild">Child</span></label>
          <label><input type="radio" name="role" value="parent" /> <span id="t-roleParent">Parent</span></label>
        </div>

        <div id="childFields">
          <div class="row" style="margin-bottom:8px">
            <label class="muted" for="loginChild" id="t-selectChild">Select child</label>
            <select id="loginChild"></select>
          </div>
        </div>

        <div id="parentFields" class="hidden">
          <div class="row" style="margin-bottom:8px">
            <label class="muted" for="loginPin" id="t-parentPin">Parent PIN</label>
            <input id="loginPin" type="password" inputmode="numeric" maxlength="6" placeholder="4‚Äì6 digits" />
          </div>
        </div>

        <div class="tutorial-controls">
          <button id="loginCancel" class="btn"><span id="t-btnCancel">Cancel</span></button>
          <button id="loginSubmit" class="btn primary"><span id="t-btnLogin">Login</span></button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast" style="display:none"></div>

    <script src="1.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      }
    </script>
  </body>
</html>
